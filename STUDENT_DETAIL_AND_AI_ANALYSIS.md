# 학생 상세 관리 및 AI 종합 분석 기능 가이드

## 📋 개요

학원장과 선생님이 학생의 학습 활동을 상세히 모니터링하고, Google AI를 활용하여 종합적인 학습 분석을 수행할 수 있는 기능이 추가되었습니다.

**배포 날짜**: 2026-01-24  
**커밋 ID**: 3fc73a8  
**작성자**: Claude AI

---

## ✨ 주요 기능

### 1️⃣ 학생 상세 정보 페이지

**경로**: `/dashboard/students/[id]`

**접근 권한**: DIRECTOR, TEACHER (같은 학원 소속만)

**주요 섹션**:

#### 📊 기본 정보
- 이메일
- 학년
- 학번
- 포인트
- 가입일
- **마지막 로그인** (한국 시간)
- 학부모 연락처

#### 💬 대화 기록 탭
- AI 봇별 대화 세션 목록
- 각 대화의 메시지 수
- **대화 날짜/시간** (한국 시간)
- 대화 소요 시간
- **대화 링크** (클릭 시 해당 봇 채팅으로 이동)
- 최근 50개 대화 표시

#### 📈 통계 탭
- 총 대화 수
- 총 메시지 수
- 평균 대화 시간
- **봇별 사용 통계**
  - 대화 횟수
  - 총 메시지 수
  - 총 대화 시간

#### 🧠 AI 분석 탭
- **AI 종합 분석 버튼** (Google AI 실시간 분석)
- 개별 대화 분석 결과
  - 참여도, 응답품질, 질문깊이, 일관성 점수
  - 강점 및 개선점
  - 분석 요약

---

### 2️⃣ AI 종합 분석 기능

**AI 모델**: Google Generative AI (Gemini Pro)

**분석 데이터**:
- 학생의 모든 대화 기록 (최근 100개)
- 기존 개별 분석 결과
- 과제 정보 (상태, 점수)
- 봇별 사용 패턴

**분석 결과**:

#### 📝 전체 요약
- 학습 상태 종합 평가 (3-5문장)

#### 📚 과목별 분석
각 과목(국어, 영어, 수학, 과학, 사회)에 대해:
- 수준: 상/중/하
- 점수: 0-100점
- 강점 목록
- 약점 목록
- 추천사항

#### 🎯 학습 패턴
- 활동 수준: 매우 활발/활발/보통/저조
- 일관성: 매우 일관적/일관적/보통/비일관적
- 참여도 트렌드: 상승/유지/하락
- 선호 과목
- 어려워하는 과목

#### 💡 추천 사항
- **즉시 조치 사항**: 당장 필요한 조치
- **단기 목표**: 1-2개월 내 달성 목표
- **장기 목표**: 학기/학년 목표
- **학부모 가이드**: 학부모를 위한 조언

#### 🤖 봇 사용 인사이트
- 가장 많이 사용한 봇
- 봇별 효과성 평가
- 추천 봇 목록

#### 📊 진도 지표
- 질문 품질: 향상/유지/저하
- 응답 깊이: 향상/유지/저하
- 자기주도 학습: 높음/보통/낮음

---

## 🗄️ API 엔드포인트

### 1. 학생 상세 정보 조회

**GET** `/api/students/[id]`

**권한**: DIRECTOR, TEACHER (같은 학원만)

**응답**:
```json
{
  "success": true,
  "student": {
    "id": "clxxxx...",
    "name": "홍길동",
    "email": "student@example.com",
    "grade": "고3",
    "studentId": "2024001",
    "parentPhone": "010-1234-5678",
    "points": 100,
    "createdAt": "2026-01-01T00:00:00.000Z",
    "lastLoginAt": "2026-01-24T10:30:00.000Z"
  },
  "conversations": [
    {
      "id": "clxxxx...",
      "botId": "study-helper",
      "messageCount": 25,
      "userMessageCount": 13,
      "botMessageCount": 12,
      "sessionDuration": 1200,
      "lastMessageAt": "2026-01-24T09:00:00.000Z",
      "createdAt": "2026-01-24T08:40:00.000Z",
      "chatLink": "/dashboard/ai-gems/study-helper"
    }
  ],
  "aiUsageStats": [
    {
      "botId": "study-helper",
      "_count": { "id": 10 },
      "_sum": {
        "messageCount": 250,
        "sessionDuration": 12000
      }
    }
  ],
  "analyses": [
    {
      "id": "clxxxx...",
      "botId": "study-helper",
      "engagementScore": 85,
      "responseQuality": 78,
      "questionDepth": 82,
      "consistency": 90,
      "strengths": ["적극적 질문", "논리적 사고"],
      "weaknesses": ["개념 이해 부족"],
      "recommendations": ["기본 개념 복습"],
      "summary": "전반적으로 우수한 참여도...",
      "analyzedAt": "2026-01-24T08:50:00.000Z"
    }
  ]
}
```

---

### 2. AI 종합 분석 생성

**POST** `/api/students/[id]/comprehensive-analysis`

**권한**: DIRECTOR, TEACHER (같은 학원만)

**환경 변수 필요**: `GOOGLE_AI_API_KEY`

**응답**:
```json
{
  "success": true,
  "message": "AI 종합 분석이 완료되었습니다.",
  "data": {
    "studentId": "clxxxx...",
    "studentName": "홍길동",
    "analyzedAt": "2026-01-24T10:00:00.000Z",
    "analysis": {
      "overall_summary": "홍길동 학생은 전반적으로 활발한 학습 활동을 보이고 있으며...",
      "subject_analysis": {
        "국어": {
          "level": "상",
          "score": 85,
          "strengths": ["독해력 우수", "문장 구성력"],
          "weaknesses": ["맞춤법 실수"],
          "recommendations": ["어휘력 강화"]
        },
        "영어": {
          "level": "중",
          "score": 72,
          "strengths": ["기본 문법 이해"],
          "weaknesses": ["회화 연습 부족"],
          "recommendations": ["원어민 대화 연습"]
        }
      },
      "learning_patterns": {
        "activity_level": "활발",
        "consistency": "일관적",
        "engagement_trend": "상승",
        "preferred_subjects": ["국어", "사회"],
        "challenging_subjects": ["영어", "수학"]
      },
      "recommendations": {
        "immediate_actions": [
          "영어 기초 문법 복습",
          "수학 개념 정리"
        ],
        "short_term_goals": [
          "영어 단어 1000개 암기",
          "수학 기출문제 풀이"
        ],
        "long_term_goals": [
          "영어 회화 능력 향상",
          "수학 심화 학습"
        ],
        "parent_guidance": [
          "규칙적인 학습 시간 유지",
          "긍정적 피드백 제공"
        ]
      },
      "bot_usage_insights": {
        "most_used_bots": ["study-helper", "writing-coach"],
        "effectiveness_by_bot": {
          "study-helper": "매우 효과적",
          "writing-coach": "효과적"
        },
        "recommended_bots": ["math-tutor", "english-partner"]
      },
      "progress_indicators": {
        "question_quality": "향상",
        "response_depth": "향상",
        "self_directed_learning": "높음"
      }
    },
    "metadata": {
      "totalConversations": 50,
      "totalMessages": 1250,
      "averageSessionDuration": 960,
      "assignmentsCount": 15
    }
  }
}
```

---

### 3. 분석 결과 조회

**GET** `/api/students/[id]/comprehensive-analysis`

**권한**: DIRECTOR, TEACHER

최근 개별 분석 결과 20개를 반환합니다.

---

## 🌏 한국 시간 지원

### 날짜/시간 포맷

모든 날짜와 시간은 **한국 표준시(KST, Asia/Seoul)** 로 표시됩니다.

**날짜 포맷**:
- `formatDate()`: "2026년 1월 24일"

**날짜+시간 포맷**:
- `formatDateTime()`: "2026년 1월 24일 10:30"

**예시**:
```javascript
// 서버에서 UTC로 저장된 시간
"2026-01-24T01:30:00.000Z"

// 클라이언트에서 한국 시간으로 표시
"2026년 1월 24일 10:30" // UTC + 9시간
```

---

## 🎨 UI/UX 특징

### 학생 상세 페이지

**레이아웃**:
- 헤더: 학생 이름, AI 종합 분석 버튼
- 기본 정보 카드: 2x4 그리드
- 탭 메뉴: 대화 기록 / 통계 / AI 분석

**대화 기록 섹션**:
- 각 대화 카드 표시
- 봇 ID 배지
- 메시지 수, 날짜/시간
- "대화 보기" 버튼 (새 탭 열기)

**통계 섹션**:
- 3개 통계 카드 (대화 수, 메시지 수, 평균 시간)
- 봇별 상세 통계 목록

**AI 분석 섹션**:
- **종합 분석 결과** (분석 후 표시)
  - 전체 요약
  - 과목별 카드 (2열 그리드)
    - 수준 배지 (상/중/하)
    - 점수
    - 강점/약점 리스트
  - 추천 사항 (색상 구분)
- **개별 분석 결과**
  - 4개 점수 표시 (참여도, 응답품질, 질문깊이, 일관성)
  - 강점/개선점 리스트

---

## 🔒 권한 및 보안

### 접근 권한

| 역할 | 학생 상세 조회 | AI 분석 생성 | 제한 |
|-----|------------|-----------|------|
| SUPER_ADMIN | ❌ | ❌ | 구현 안됨 |
| DIRECTOR | ✅ | ✅ | 같은 학원 |
| TEACHER | ✅ | ✅ | 같은 학원 |
| STUDENT | ❌ | ❌ | 불가 |

### 보안 정책

1. **학원 소속 확인**: 같은 `academyId`만 조회 가능
2. **역할 검증**: DIRECTOR, TEACHER만 접근
3. **세션 인증**: NextAuth 세션 필수

---

## 🔧 환경 변수 설정

### Google AI API 키

AI 종합 분석을 사용하려면 Google AI API 키가 필요합니다.

**Vercel 설정**:
1. Vercel 대시보드 접속
2. 프로젝트 선택
3. Settings → Environment Variables
4. 새 변수 추가:
   - Key: `GOOGLE_AI_API_KEY`
   - Value: `AIzaSy...` (Google AI Studio에서 발급)
   - Environment: Production, Preview, Development

**로컬 개발**:
```bash
# .env.local
GOOGLE_AI_API_KEY=AIzaSy...
```

**API 키 발급 방법**:
1. https://makersuite.google.com/app/apikey 접속
2. "Create API Key" 클릭
3. 프로젝트 선택 또는 새로 생성
4. API 키 복사

---

## 🧪 테스트 시나리오

### 1. 학생 상세 페이지 접속

**사전 준비**:
- 학원장 또는 선생님 계정
- 학생 계정 (같은 학원)
- 학생이 AI 봇과 대화 기록 보유

**테스트**:
1. 학원장/선생님으로 로그인
2. `/dashboard/students` 접속
3. 학생 카드에서 "상세" 버튼 클릭
4. `/dashboard/students/[id]` 페이지 표시 확인

**확인 사항**:
- 기본 정보가 정확히 표시되는가?
- 마지막 로그인 시간이 한국 시간으로 표시되는가?
- 대화 기록이 최신순으로 정렬되어 있는가?

---

### 2. 대화 기록 확인

**테스트**:
1. "대화 기록" 탭 선택
2. 대화 카드 확인
3. "대화 보기" 버튼 클릭

**확인 사항**:
- 대화 날짜/시간이 한국 시간인가?
- 대화 시간(Duration)이 정확한가?
- "대화 보기" 클릭 시 해당 봇 채팅 페이지로 이동하는가?

---

### 3. 통계 확인

**테스트**:
1. "통계" 탭 선택
2. 통계 카드 확인
3. 봇별 사용 통계 확인

**확인 사항**:
- 총 대화 수가 정확한가?
- 평균 대화 시간이 합리적인가?
- 봇별 통계가 올바른가?

---

### 4. AI 종합 분석

**사전 준비**:
- `GOOGLE_AI_API_KEY` 환경 변수 설정
- 학생의 충분한 대화 기록 (최소 5개 이상 권장)

**테스트**:
1. "AI 분석" 탭 선택
2. "AI 종합 분석" 버튼 클릭
3. 로딩 상태 확인 (스피너)
4. 분석 결과 표시 확인

**확인 사항**:
- 분석이 완료되는가? (약 10-30초 소요)
- 전체 요약이 한국어로 표시되는가?
- 과목별 분석이 표시되는가?
- 강점/약점/추천사항이 구체적인가?
- 원본 분석 결과를 펼쳐 볼 수 있는가?

---

### 5. 에러 처리

**테스트 케이스**:

#### a) API 키 없음
1. `GOOGLE_AI_API_KEY` 제거
2. "AI 종합 분석" 버튼 클릭
3. 에러 메시지 확인: "Google AI API 키가 설정되지 않았습니다."

#### b) 다른 학원 학생
1. 다른 학원의 학생 ID로 직접 URL 접속
2. 403 에러 확인: "같은 학원 소속 학생만 조회할 수 있습니다."

#### c) 권한 없는 역할
1. STUDENT 계정으로 로그인
2. 학생 상세 페이지 접속 시도
3. 403 에러 확인

---

## 💡 사용 사례

### 학원장

**주간 학생 모니터링**:
1. 각 학생의 상세 페이지 확인
2. 대화 기록으로 학습 활동 점검
3. 통계로 참여도 파악
4. AI 종합 분석으로 학습 상태 평가

**학부모 상담 준비**:
1. 학생 상세 페이지에서 데이터 수집
2. AI 종합 분석 결과 출력
3. 과목별 강점/약점 정리
4. 추천 사항 및 목표 제시

---

### 선생님

**개별 학생 관리**:
1. 담당 학생 목록에서 상세 페이지 접속
2. 대화 기록으로 학습 태도 파악
3. 봇별 사용 통계로 선호 과목 확인
4. AI 분석으로 맞춤 지도 계획 수립

**과제 피드백**:
1. 학생의 AI 대화 기록 확인
2. 질문 패턴 분석
3. 이해도 파악
4. 개선 방향 제시

---

## 📊 분석 예시

### 샘플 AI 종합 분석 결과

```
홍길동 학생 AI 종합 분석 결과

[전체 요약]
홍길동 학생은 최근 2개월간 50회의 AI 봇 대화를 진행하였으며, 
평균 16분간 집중하여 학습하는 모습을 보였습니다. 
특히 국어와 사회 과목에서 높은 관심을 보이고 있으며, 
질문의 깊이가 점차 향상되고 있습니다.

[과목별 분석]

📚 국어 (85점 / 상)
강점:
- 독해력이 우수하며 문맥 파악 능력이 뛰어남
- 문학 작품에 대한 이해도가 높음
- 논리적인 글쓰기 능력

약점:
- 간혹 맞춤법 실수가 발생
- 고전 문학에 대한 배경지식 부족

추천사항:
- 고전 문학 작품 읽기
- 한자 어휘 학습 강화
- 논술형 문제 연습

📖 영어 (72점 / 중)
강점:
- 기본 문법 이해도 양호
- 단어 암기 성실

약점:
- 회화 연습 부족
- 긴 문장 독해 어려움
- 듣기 능력 향상 필요

추천사항:
- 원어민 대화 연습 (english-partner 봇 활용)
- 영어 뉴스 듣기
- 장문 독해 연습

[학습 패턴]
- 활동 수준: 활발 (주 10회 이상 대화)
- 일관성: 일관적 (규칙적인 학습 시간)
- 참여도 트렌드: 상승 (지난달 대비 20% 증가)
- 선호 과목: 국어, 사회
- 도전 과목: 영어, 수학

[즉시 조치 사항]
1. 영어 기초 문법 복습 (1주)
2. 수학 개념 정리 노트 작성 (2주)
3. 매일 영어 단어 30개 암기

[단기 목표 (1-2개월)]
1. 영어 단어 1000개 암기 완료
2. 수학 기출문제 100문제 풀이
3. 국어 고전 문학 10편 읽기

[장기 목표 (학기)]
1. 영어 모의고사 80점 이상
2. 수학 개념 완전 이해
3. 자기주도 학습 습관 확립

[학부모 가이드]
- 규칙적인 학습 시간 유지 독려
- 긍정적 피드백과 격려
- 영어 회화 학원 추가 고려
- 주말 독서 시간 확보
```

---

## 🚨 주의사항

### 1. Google AI API 비용

**요금제**:
- Gemini Pro: 무료 (월 60회 / 분당 제한)
- Gemini Pro (유료): $0.00025 / 1000 characters

**비용 예상**:
- 학생 1명당 분석: 약 5,000 characters
- 비용: 약 $0.00125
- 학생 100명 분석: 약 $0.125

**권장사항**:
- 필요시에만 분석 실행
- 무료 할당량 관리
- 정기 분석은 주 1회 또는 월 1회

---

### 2. 분석 정확도

**AI 분석의 한계**:
- 데이터가 충분하지 않으면 정확도 낮음
- 최소 5개 이상의 대화 권장
- 다양한 봇과의 대화가 있어야 과목별 분석 가능

**참고용으로 활용**:
- AI 분석은 참고 자료
- 실제 학습 상담 시 종합적 판단 필요
- 학생의 실제 성적, 태도와 함께 고려

---

### 3. 개인정보 보호

**민감 정보 처리**:
- 학생 대화 내용은 Google AI로 전송됨
- 개인 식별 정보는 최소화
- 학부모 동의 확인 권장

**데이터 보관**:
- 분석 결과는 DB에 저장되지 않음 (선택적)
- 대화 기록은 암호화 저장
- 접근 권한 엄격히 관리

---

## 🔄 향후 개선 사항

### 1. 분석 결과 저장
- 종합 분석 결과를 DB에 저장
- 이전 분석과 비교
- 진도 추이 그래프

### 2. 자동 분석
- 주기적 자동 분석 (주 1회)
- 알림 기능
- 이메일 리포트

### 3. 비교 기능
- 학생 간 비교 (익명)
- 학년별 평균과 비교
- 과목별 순위

### 4. 추천 시스템
- 학생에게 적합한 봇 자동 추천
- 학습 자료 추천
- 과제 난이도 조정

### 5. 엑셀 내보내기
- 분석 결과 엑셀 다운로드
- 학부모 리포트 생성
- 학기말 종합 리포트

---

## 📁 관련 파일

### API
- `src/app/api/students/[id]/route.ts` - 학생 상세 정보 API
- `src/app/api/students/[id]/comprehensive-analysis/route.ts` - AI 종합 분석 API

### 페이지
- `src/app/dashboard/students/[id]/page.tsx` - 학생 상세 페이지
- `src/app/dashboard/students/page.tsx` - 학생 목록 페이지

---

## 📞 문의 및 지원

**문제 발생 시**:
1. 브라우저 콘솔 로그 확인
2. 네트워크 탭에서 API 응답 확인
3. 환경 변수 설정 재확인
4. GitHub Issues에 재현 방법과 함께 등록

**추가 기능 요청**:
- 구체적인 사용 사례 제시
- 기대하는 결과 설명
- 우선순위 명시

---

**배포 URL**: https://superplace-study.vercel.app  
**GitHub**: https://github.com/kohsunwoo12345-cmyk/superplace  
**커밋**: 3fc73a8  
**날짜**: 2026-01-24

© 2026 SUPER PLACE - All Rights Reserved
