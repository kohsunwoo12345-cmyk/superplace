-- ============================================================
-- ğŸ” í•™ì›ì¥ ID 208 ì™„ì „ ì§„ë‹¨
-- ============================================================
-- Cloudflare D1 Consoleì—ì„œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ì„¸ìš”
-- ============================================================

-- STEP 1: í•™ì›ì¥ ID 208 ì •ë³´ í™•ì¸
-- ============================================================
SELECT '
==============================================
STEP 1: í•™ì›ì¥ ID 208 ê¸°ë³¸ ì •ë³´
==============================================
' as info;
SELECT 
  id,
  name,
  email,
  role,
  academy_id,
  created_at
FROM users 
WHERE id = '208';


-- STEP 2: academy_id í™•ì¸ (ìˆ«ì vs ë¬¸ìì—´)
-- ============================================================
SELECT '
==============================================
STEP 2: ID 208ì´ DIRECTORì¸ì§€ í™•ì¸
==============================================
' as info;
SELECT 
  id,
  name,
  email,
  role,
  academy_id
FROM users 
WHERE id = '208' OR id = 208;


-- STEP 3: ì´ í•™ì›ì¥ì˜ academy_id ê°’ í™•ì¸
-- ============================================================
SELECT '
==============================================
STEP 3: í•™ì›ì¥ì˜ academy_id í™•ì¸
==============================================
' as info;
SELECT 
  DISTINCT academy_id
FROM users 
WHERE id = '208' OR id = 208;


-- STEP 4: ê°™ì€ academy_idë¥¼ ê°€ì§„ ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ
-- ============================================================
SELECT '
==============================================
STEP 4: academy_idê°€ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ì‚¬ìš©ì
==============================================
' as info;
-- ë¨¼ì € í•™ì›ì¥ì˜ academy_idë¥¼ ì°¾ì•„ì„œ ì‚¬ìš©
SELECT 
  u.id,
  u.name,
  u.email,
  u.role,
  u.academy_id,
  u.created_at
FROM users u
WHERE u.academy_id = (
  SELECT academy_id FROM users WHERE id = '208' OR id = 208 LIMIT 1
)
ORDER BY u.role, u.created_at DESC;


-- STEP 5: ëª¨ë“  í•™ìƒ ì¡°íšŒ (academy_id ë¬´ê´€)
-- ============================================================
SELECT '
==============================================
STEP 5: ëª¨ë“  í•™ìƒ ëª©ë¡ (ìµœê·¼ 20ëª…)
==============================================
' as info;
SELECT 
  id,
  name,
  email,
  academy_id,
  created_at
FROM users 
WHERE role = 'STUDENT'
ORDER BY created_at DESC
LIMIT 20;


-- STEP 6: ID 208ì„ academy_idë¡œ ê°€ì§„ í•™ìƒ ì¡°íšŒ
-- ============================================================
SELECT '
==============================================
STEP 6: academy_id = 208ì¸ í•™ìƒ
==============================================
' as info;
SELECT 
  id,
  name,
  email,
  role,
  academy_id,
  created_at
FROM users 
WHERE academy_id = '208' OR academy_id = 208
ORDER BY role, created_at DESC;


-- STEP 7: í•™ìƒ academy_id ë¶„í¬
-- ============================================================
SELECT '
==============================================
STEP 7: í•™ìƒë“¤ì˜ academy_id ë¶„í¬
==============================================
' as info;
SELECT 
  COALESCE(academy_id, 'NULL') as academy_id,
  COUNT(*) as student_count
FROM users 
WHERE role = 'STUDENT'
GROUP BY academy_id
ORDER BY student_count DESC;


-- STEP 8: ëª¨ë“  DIRECTOR ì¡°íšŒ
-- ============================================================
SELECT '
==============================================
STEP 8: ëª¨ë“  í•™ì›ì¥ ëª©ë¡
==============================================
' as info;
SELECT 
  id,
  name,
  email,
  academy_id,
  created_at
FROM users 
WHERE role = 'DIRECTOR'
ORDER BY created_at DESC;


-- STEP 9: users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
-- ============================================================
SELECT '
==============================================
STEP 9: users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ
==============================================
' as info;
PRAGMA table_info(users);


-- STEP 10: í•´ê²° ë°©ì•ˆ - ëª¨ë“  í•™ìƒì„ ID 208ë¡œ ì—°ê²°
-- ============================================================
SELECT '
==============================================
STEP 10: í•´ê²° SQL (ì•„ì§ ì‹¤í–‰í•˜ì§€ ë§ˆì„¸ìš”!)
==============================================
' as info;
SELECT 'UPDATE users SET academy_id = ''208'' WHERE role = ''STUDENT'';' as fix_sql;


-- ============================================================
-- ğŸ“‹ ì§„ë‹¨ ê²°ê³¼ ì²´í¬ë¦¬ìŠ¤íŠ¸
-- ============================================================
-- [ ] STEP 2: ID 208ì´ DIRECTOR ì—­í• ì¸ê°€?
-- [ ] STEP 3: academy_id ê°’ì´ ë¬´ì—‡ì¸ê°€? (208? NULL? ë‹¤ë¥¸ ê°’?)
-- [ ] STEP 4: ê°™ì€ academy_idë¥¼ ê°€ì§„ í•™ìƒì´ ìˆëŠ”ê°€?
-- [ ] STEP 5: ì‹¤ì œë¡œ í•™ìƒì´ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ”ê°€?
-- [ ] STEP 6: academy_id = 208ì¸ í•™ìƒì´ ìˆëŠ”ê°€?
-- [ ] STEP 7: í•™ìƒë“¤ì´ ì–´ë–¤ academy_idë¥¼ ê°€ì§€ê³  ìˆëŠ”ê°€?
-- ============================================================

-- âš ï¸ ì£¼ì˜: STEP 10ì˜ UPDATEëŠ” ì§„ë‹¨ í›„ í•„ìš”ì‹œì—ë§Œ ì‹¤í–‰í•˜ì„¸ìš”!
