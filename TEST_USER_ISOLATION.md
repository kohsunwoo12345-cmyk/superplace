// μ‚¬μ©μλ³„ λ°μ‹ λ²νΈ λ° μΉ΄μΉ΄μ¤ μ±„λ„ κ²€μ¦ ν…μ¤νΈ

console.log('='.repeat(60));
console.log('π“‹ λ©”μ‹μ§€ λ°μ†΅ μ‹μ¤ν… μ‚¬μ©μ κ¶ν• κ²€μ¦ ν…μ¤νΈ');
console.log('='.repeat(60));

/**
 * ν…μ¤νΈ μ‹λ‚λ¦¬μ¤
 * 
 * 1. SMS λ°μ†΅ - μ‚¬μ©μλ³„ λ°μ‹ λ²νΈ κ²€μ¦
 *    - β… μμ‹ μ΄ λ“±λ΅ν•κ³  μΉμΈλ°›μ€ λ°μ‹ λ²νΈλ΅ λ°μ†΅ β†’ μ„±κ³µ
 *    - β λ‹¤λ¥Έ μ‚¬μ©μμ λ°μ‹ λ²νΈλ΅ λ°μ†΅ μ‹λ„ β†’ 403 μ—λ¬
 *    - β μΉμΈλμ§€ μ•μ€ λ°μ‹ λ²νΈλ΅ λ°μ†΅ μ‹λ„ β†’ 403 μ—λ¬
 * 
 * 2. μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅ λ°μ†΅ - μ‚¬μ©μλ³„ μ±„λ„ κ²€μ¦
 *    - β… μμ‹ μ΄ λ“±λ΅ν•κ³  μΉμΈλ°›μ€ μΉ΄μΉ΄μ¤ μ±„λ„λ΅ λ°μ†΅ β†’ μ„±κ³µ
 *    - β λ‹¤λ¥Έ μ‚¬μ©μμ μΉ΄μΉ΄μ¤ μ±„λ„λ΅ λ°μ†΅ μ‹λ„ β†’ 403 μ—λ¬
 *    - β μΉμΈλμ§€ μ•μ€ μΉ΄μΉ΄μ¤ μ±„λ„λ΅ λ°μ†΅ μ‹λ„ β†’ 403 μ—λ¬
 * 
 * 3. ν¬μΈνΈ μ°¨κ°
 *    - β… μ‚¬μ©μλ³„λ΅ λ…λ¦½μ μΈ ν¬μΈνΈ μ°¨κ°
 *    - β… ν¬μΈνΈ λ¶€μ΅± μ‹ λ°μ†΅ λ¶κ°€
 */

console.log('\nπ“ ν…μ¤νΈ μΌ€μ΄μ¤ 1: SMS λ°μ†΅λ²νΈ κ²€μ¦');
console.log('-'.repeat(60));

console.log(`
β… μ„±κ³µ μΌ€μ΄μ¤:
   μ‚¬μ©μ Aκ°€ μμ‹ μ΄ λ“±λ΅ν• λ°μ‹ λ²νΈ "010-1234-5678"λ΅ SMS λ°μ†΅
   
   μ”μ²­:
   POST /api/messages/send
   {
     "messageType": "SMS",
     "senderNumber": "010-1234-5678",
     "messageContent": "μ•λ…•ν•μ„Έμ”",
     "recipients": [...]
   }
   
   μ²λ¦¬ κ³Όμ •:
   1. JWT ν† ν°μ—μ„ μ‚¬μ©μ ID μ¶”μ¶ (userId = 1)
   2. DB μΏΌλ¦¬: 
      SELECT * FROM SenderNumber 
      WHERE userId = 1 
      AND phoneNumber = '010-1234-5678' 
      AND status = 'APPROVED'
   3. κ²°κ³Ό μ΅΄μ¬ β†’ λ°μ†΅ ν—μ©
   4. Solapi API νΈμ¶ (from: 010-1234-5678)
   5. ν¬μΈνΈ μ°¨κ° (User.id = 1)
`);

console.log(`
β μ‹¤ν¨ μΌ€μ΄μ¤ 1: λ‹¤λ¥Έ μ‚¬μ©μμ λ°μ‹ λ²νΈ μ‚¬μ©
   μ‚¬μ©μ Aκ°€ μ‚¬μ©μ Bμ λ°μ‹ λ²νΈ "010-9999-8888"λ΅ λ°μ†΅ μ‹λ„
   
   μ”μ²­:
   POST /api/messages/send
   {
     "messageType": "SMS",
     "senderNumber": "010-9999-8888",  // μ‚¬μ©μ B μ†μ 
     "messageContent": "μ•λ…•ν•μ„Έμ”",
     "recipients": [...]
   }
   
   μ²λ¦¬ κ³Όμ •:
   1. JWT ν† ν°μ—μ„ μ‚¬μ©μ ID μ¶”μ¶ (userId = 1)
   2. DB μΏΌλ¦¬:
      SELECT * FROM SenderNumber 
      WHERE userId = 1  // μ‚¬μ©μ A
      AND phoneNumber = '010-9999-8888'  // μ‚¬μ©μ B μ†μ 
      AND status = 'APPROVED'
   3. β κ²°κ³Ό μ—†μ β†’ 403 μ—λ¬ λ°ν™
   4. μ—λ¬ λ©”μ‹μ§€: "λ“±λ΅λμ§€ μ•μ•κ±°λ‚ μΉμΈλμ§€ μ•μ€ λ°μ‹ λ²νΈμ…λ‹λ‹¤."
`);

console.log(`
β μ‹¤ν¨ μΌ€μ΄μ¤ 2: μΉμΈλμ§€ μ•μ€ λ°μ‹ λ²νΈ
   μ‚¬μ©μ Aκ°€ μμ‹ μ λ―ΈμΉμΈ λ°μ‹ λ²νΈλ΅ λ°μ†΅ μ‹λ„
   
   μ”μ²­:
   POST /api/messages/send
   {
     "messageType": "SMS",
     "senderNumber": "010-5555-6666",  // λ€κΈ° μ¤‘
     "messageContent": "μ•λ…•ν•μ„Έμ”",
     "recipients": [...]
   }
   
   μ²λ¦¬ κ³Όμ •:
   1. JWT ν† ν°μ—μ„ μ‚¬μ©μ ID μ¶”μ¶ (userId = 1)
   2. DB μΏΌλ¦¬:
      SELECT * FROM SenderNumber 
      WHERE userId = 1 
      AND phoneNumber = '010-5555-6666'
      AND status = 'APPROVED'  // ν„μ¬ PENDING
   3. β κ²°κ³Ό μ—†μ β†’ 403 μ—λ¬ λ°ν™
`);

console.log('\nπ“ ν…μ¤νΈ μΌ€μ΄μ¤ 2: μΉ΄μΉ΄μ¤ μ±„λ„ κ²€μ¦');
console.log('-'.repeat(60));

console.log(`
β… μ„±κ³µ μΌ€μ΄μ¤:
   μ‚¬μ©μ Aκ°€ μμ‹ μ΄ λ“±λ΅ν• μΉ΄μΉ΄μ¤ μ±„λ„λ΅ μ•λ¦Όν†΅ λ°μ†΅
   
   μ”μ²­:
   POST /api/kakao/send-alimtalk
   {
     "channelId": "channel_abc123",
     "templateId": "template_001",
     "recipients": [...]
   }
   
   μ²λ¦¬ κ³Όμ •:
   1. JWT ν† ν°μ—μ„ μ‚¬μ©μ ID μ¶”μ¶ (userId = 1)
   2. DB μΏΌλ¦¬:
      SELECT channelId, phoneNumber, solapiChannelId 
      FROM KakaoChannel 
      WHERE userId = 1 
      AND channelId = 'channel_abc123' 
      AND status = 'APPROVED'
   3. κ²°κ³Ό μ΅΄μ¬ β†’ λ°μ†΅ ν—μ©
   4. Solapi API νΈμ¶
      - from: μ±„λ„μ— λ“±λ΅λ μ „ν™”λ²νΈ
      - pfId: solapiChannelId (Solapiμ— λ“±λ΅λ μ±„λ„ ID)
   5. ν¬μΈνΈ μ°¨κ° (User.id = 1)
`);

console.log(`
β μ‹¤ν¨ μΌ€μ΄μ¤: λ‹¤λ¥Έ μ‚¬μ©μμ μΉ΄μΉ΄μ¤ μ±„λ„ μ‚¬μ©
   μ‚¬μ©μ Aκ°€ μ‚¬μ©μ Bμ μΉ΄μΉ΄μ¤ μ±„λ„λ΅ λ°μ†΅ μ‹λ„
   
   μ”μ²­:
   POST /api/kakao/send-alimtalk
   {
     "channelId": "channel_xyz789",  // μ‚¬μ©μ B μ†μ 
     "templateId": "template_001",
     "recipients": [...]
   }
   
   μ²λ¦¬ κ³Όμ •:
   1. JWT ν† ν°μ—μ„ μ‚¬μ©μ ID μ¶”μ¶ (userId = 1)
   2. DB μΏΌλ¦¬:
      SELECT * FROM KakaoChannel 
      WHERE userId = 1  // μ‚¬μ©μ A
      AND channelId = 'channel_xyz789'  // μ‚¬μ©μ B μ†μ 
      AND status = 'APPROVED'
   3. β κ²°κ³Ό μ—†μ β†’ 403 μ—λ¬ λ°ν™
   4. μ—λ¬ λ©”μ‹μ§€: "λ“±λ΅λμ§€ μ•μ•κ±°λ‚ μΉμΈλμ§€ μ•μ€ μΉ΄μΉ΄μ¤ μ±„λ„μ…λ‹λ‹¤."
`);

console.log('\nπ“ ν…μ¤νΈ μΌ€μ΄μ¤ 3: ν¬μΈνΈ μ°¨κ° λ…λ¦½μ„±');
console.log('-'.repeat(60));

console.log(`
μ‹λ‚λ¦¬μ¤:
- μ‚¬μ©μ A (userId=1): λ³΄μ  ν¬μΈνΈ 1000P
- μ‚¬μ©μ B (userId=2): λ³΄μ  ν¬μΈνΈ 500P

1. μ‚¬μ©μ Aκ°€ SMS 10κ±΄ λ°μ†΅ (200P μ°¨κ°)
   β†’ User.id=1 μ points: 1000 β†’ 800
   β†’ User.id=2 μ points: 500 (λ³€ν™” μ—†μ)

2. μ‚¬μ©μ Bκ°€ μΉ΄μΉ΄μ¤ μ•λ¦Όν†΅ 5κ±΄ λ°μ†΅ (75P μ°¨κ°)
   β†’ User.id=1 μ points: 800 (λ³€ν™” μ—†μ)
   β†’ User.id=2 μ points: 500 β†’ 425

κ° μ‚¬μ©μμ ν¬μΈνΈκ°€ λ…λ¦½μ μΌλ΅ μ°¨κ°λμ–΄ μ„λ΅ μν–¥μ„ μ£Όμ§€ μ•μ
`);

console.log('\nπ“ DB ν…μ΄λΈ” κµ¬μ΅°');
console.log('-'.repeat(60));

console.log(`
SenderNumber ν…μ΄λΈ”:
β”β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ id β”‚ userId β”‚ phoneNumber    β”‚ status   β”‚ createdAt  β”‚
β”β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1  β”‚ 1      β”‚ 010-1234-5678  β”‚ APPROVED β”‚ 2024-01-01 β”‚
β”‚ 2  β”‚ 1      β”‚ 010-5555-6666  β”‚ PENDING  β”‚ 2024-01-02 β”‚
β”‚ 3  β”‚ 2      β”‚ 010-9999-8888  β”‚ APPROVED β”‚ 2024-01-03 β”‚
β””β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

KakaoChannel ν…μ΄λΈ”:
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ channelId      β”‚ userId β”‚ phoneNumber  β”‚ status   β”‚ solapiChannelId β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ channel_abc123 β”‚ 1      β”‚ 010-1111-2222β”‚ APPROVED β”‚ SOLAPI_CH_001   β”‚
β”‚ channel_def456 β”‚ 1      β”‚ 010-3333-4444β”‚ PENDING  β”‚ null            β”‚
β”‚ channel_xyz789 β”‚ 2      β”‚ 010-7777-8888β”‚ APPROVED β”‚ SOLAPI_CH_002   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

User ν…μ΄λΈ”:
β”β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ id β”‚ name     β”‚ points β”‚
β”β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1  β”‚ μ‚¬μ©μA  β”‚ 1000   β”‚
β”‚ 2  β”‚ μ‚¬μ©μB  β”‚ 500    β”‚
β””β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”
`);

console.log('\nπ” λ³΄μ• μ²΄ν¬λ¦¬μ¤νΈ');
console.log('-'.repeat(60));

console.log(`
β… JWT ν† ν° κ²€μ¦
   - Authorization ν—¤λ”μ—μ„ Bearer ν† ν° μ¶”μ¶
   - ν† ν° λ””μ½”λ”©ν•μ—¬ μ‚¬μ©μ ID μ¶”μ¶
   - μ ν¨ν•μ§€ μ•μ€ ν† ν° β†’ 401 Unauthorized

β… λ°μ‹ λ²νΈ μ†μ κ¶ κ²€μ¦
   - WHERE userId = ? AND phoneNumber = ?
   - λ‹¤λ¥Έ μ‚¬μ©μ λ²νΈ μ‚¬μ© μ‹λ„ β†’ 403 Forbidden

β… μΉ΄μΉ΄μ¤ μ±„λ„ μ†μ κ¶ κ²€μ¦
   - WHERE userId = ? AND channelId = ?
   - λ‹¤λ¥Έ μ‚¬μ©μ μ±„λ„ μ‚¬μ© μ‹λ„ β†’ 403 Forbidden

β… μΉμΈ μƒνƒ κ²€μ¦
   - WHERE status = 'APPROVED'
   - PENDING/REJECTED μƒνƒ β†’ 403 Forbidden

β… ν¬μΈνΈ κ²©λ¦¬
   - UPDATE User SET points = points - ? WHERE id = ?
   - μ‚¬μ©μλ³„ λ…λ¦½μ μΈ ν¬μΈνΈ μ°¨κ°

β… SQL Injection λ°©μ§€
   - Prepared Statement μ‚¬μ© (.bind() λ©”μ†λ“)
   - λ¨λ“  μ‚¬μ©μ μ…λ ¥κ°’ νλΌλ―Έν„° λ°”μΈλ”©
`);

console.log('\nβ¨ κ²°λ΅ ');
console.log('='.repeat(60));

console.log(`
ν„μ¬ κµ¬ν„λ μ‹μ¤ν…μ€ λ‹¤μμ„ λ³΄μ¥ν•©λ‹λ‹¤:

1. μ‚¬μ©μλ” μμ‹ μ΄ λ“±λ΅ν•κ³  μΉμΈλ°›μ€ λ°μ‹ λ²νΈλ§ μ‚¬μ© κ°€λ¥
2. μ‚¬μ©μλ” μμ‹ μ΄ λ“±λ΅ν•κ³  μΉμΈλ°›μ€ μΉ΄μΉ΄μ¤ μ±„λ„λ§ μ‚¬μ© κ°€λ¥
3. κ° μ‚¬μ©μμ ν¬μΈνΈλ” λ…λ¦½μ μΌλ΅ κ΄€λ¦¬λ¨
4. λ‹¤λ¥Έ μ‚¬μ©μμ μμ›μ„ λ¬΄λ‹¨μΌλ΅ μ‚¬μ©ν•  μ μ—†μ
5. JWT ν† ν°μΌλ΅ λ¨λ“  μ”μ²­μ μ‚¬μ©μ μ‹ μ› ν™•μΈ
6. DB λ λ²¨μ—μ„ userId κΈ°λ° κ¶ν• κ²€μ¦

π‘ μ‚¬μ©μλ³„ κ²©λ¦¬κ°€ μ™„λ²½ν•κ² κµ¬ν„λμ—μµλ‹λ‹¤!
`);

console.log('='.repeat(60));
