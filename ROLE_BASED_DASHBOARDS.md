# 역할별 대시보드 시스템 ✅

## 📋 개요

사용자 역할(관리자, 학원장, 선생님, 학생)에 따라 맞춤형 대시보드를 제공합니다.
각 역할에 필요한 정보와 기능이 최적화되어 표시됩니다.

## 🎯 역할별 대시보드

### 1. 관리자 (ADMIN / SUPER_ADMIN) 대시보드

#### 표시 정보
- **전체 사용자**: 총 회원 수 + 이번 달 신규 가입자
- **등록된 학원**: 활성 학원 수 / 전체 학원 수
- **활성 학생**: 전체 학생 수
- **AI 사용량**: 이번 달 AI 사용 횟수

#### 주요 기능
- **회원 관리**
  - 최근 7일 가입 사용자 목록
  - 이름, 역할, 학원, 가입일 표시
  - 전체 사용자 보기 링크

- **오늘 현황**
  - 오늘 출석한 학생 수
  - 오늘 숙제 제출 개수
  - 총 구매 건수 (준비 중)

- **관리 메뉴**
  - 사용자 관리
  - 학원 관리
  - AI 봇 관리
  - 문의 관리

### 2. 학원장 (DIRECTOR) / 선생님 (TEACHER) 대시보드

#### 표시 정보
- **전체 학생**: 총 학생 수 + 선생님 수
- **오늘 출석**: 오늘 출석한 학생 수 + 출석률
- **숙제 제출**: 오늘 제출된 숙제 개수
- **미제출**: 숙제 미제출 학생 수

#### 주요 기능

##### 📢 출석 알림
```
실시간으로 학생 출석 현황을 표시

┌─────────────────────────────┐
│ 오늘 출석 알림               │
├─────────────────────────────┤
│ ✓ 김학생    09:00  [숙제 ✓] │
│ ✓ 이학생    09:15  [미제출]  │
│ ✓ 박학생    09:30  [숙제 ✓] │
└─────────────────────────────┘
```

- 학생 이름
- 출석 시간
- 숙제 제출 여부

##### 📝 숙제 검사 결과
```
AI가 채점한 숙제 결과 표시

┌─────────────────────────────┐
│ 숙제 검사 결과               │
├─────────────────────────────┤
│ 김학생        85점          │
│ [수학] 완성도: 상 노력도: 상 │
├─────────────────────────────┤
│ 이학생        90점          │
│ [영어] 완성도: 상 노력도: 상 │
└─────────────────────────────┘
```

- 학생 이름
- 채점 점수
- 과목
- 완성도/노력도

##### ⚠️ 숙제 미제출 알림
```
출석했지만 숙제 미제출 학생 표시

┌─────────────────────────────┐
│ 숙제 미제출                  │
├─────────────────────────────┤
│ ⚠️ 박학생  출석: 09:30 [알림]│
│ ⚠️ 최학생  출석: 09:45 [알림]│
└─────────────────────────────┘
```

- 학생 이름
- 출석 시간
- 알림 버튼

### 3. 학생 (STUDENT) 대시보드

#### 표시 정보
- **출석일**: 이번 달 출석 일수
- **완료 과제**: 이번 달 제출한 숙제 개수
- **평균 점수**: 전체 평균 점수
- **학습 시간**: 이번 주 학습 시간

#### 주요 기능
- 제출할 과제 목록
- 오늘의 일정
- 학습 진도 확인

## 🔧 API 엔드포인트

### GET /api/admin/dashboard-stats
관리자 대시보드 통계

**Response**:
```json
{
  "success": true,
  "totalUsers": 116,
  "newUsersThisMonth": 8,
  "usersByRole": {
    "STUDENT": 100,
    "TEACHER": 10,
    "DIRECTOR": 5,
    "ADMIN": 1
  },
  "totalStudents": 100,
  "recentUsers": [
    {
      "id": "116",
      "name": "김학생",
      "email": "student@test.com",
      "role": "STUDENT",
      "academy": "테스트학원",
      "createdAt": "2026-02-05 14:06:59"
    }
  ],
  "todayAttendance": 25,
  "todayHomework": 18,
  "totalPurchases": 0,
  "totalRevenue": 0
}
```

### GET /api/dashboard/director-stats
학원장/선생님 대시보드 통계

**Response**:
```json
{
  "success": true,
  "totalStudents": 100,
  "totalTeachers": 10,
  "attendanceRate": 85,
  "activeHomework": 5,
  "todayStats": {
    "attendance": 25,
    "homeworkSubmitted": 18,
    "homeworkGraded": 15,
    "missingHomework": 7
  },
  "attendanceAlerts": [
    {
      "studentId": "112",
      "studentName": "김학생",
      "time": "2026-02-05 09:00:00",
      "homeworkSubmitted": true
    }
  ],
  "homeworkResults": [
    {
      "studentId": "112",
      "studentName": "김학생",
      "score": 85,
      "subject": "수학",
      "completion": "상",
      "effort": "상",
      "feedback": "잘 작성했습니다...",
      "submittedAt": "2026-02-05 09:15:00"
    }
  ],
  "missingHomeworkList": [
    {
      "studentId": "113",
      "studentName": "박학생",
      "email": "student2@test.com",
      "attendedAt": "2026-02-05 09:30:00"
    }
  ]
}
```

## 📊 데이터 흐름

### 관리자 대시보드
```
로그인
  ↓
역할 확인 (ADMIN / SUPER_ADMIN)
  ↓
GET /api/admin/dashboard-stats
  ↓
- 전체 사용자 통계
- 최근 가입 사용자
- 오늘 출석/숙제 현황
- 학원 통계
```

### 학원장/선생님 대시보드
```
로그인
  ↓
역할 확인 (DIRECTOR / TEACHER)
  ↓
GET /api/dashboard/director-stats
  ↓
- 학생/선생님 통계
- 출석 알림 (실시간)
- 숙제 검사 결과
- 미제출 알림
```

### 학생 대시보드
```
로그인
  ↓
역할 확인 (STUDENT)
  ↓
GET /api/dashboard/student-stats
  ↓
- 개인 출석 기록
- 숙제 제출 현황
- 평균 점수
- 학습 시간
```

## 🎨 UI 구성

### 관리자 대시보드
```
┌────────────────────────────────────────────┐
│  시스템 관리자 대시보드                     │
│  전체 시스템 현황을 모니터링하고 관리합니다  │
├────────────────────────────────────────────┤
│ [전체 사용자] [등록 학원] [활성 학생] [AI사용]│
│    116명         5개         100명      50  │
│   +8명 이번달                                │
├────────────────────────────────────────────┤
│ [사용자 관리] [학원 관리] [AI봇 관리] [문의]  │
├────────────────────────────────────────────┤
│ 최근 가입 사용자 │ 오늘 현황                │
│ • 김학생 (학생)  │ 출석: 25명              │
│ • 이선생 (선생님)│ 숙제: 18개              │
│ • 박학원장       │ 구매: 0건 (준비중)       │
└────────────────────────────────────────────┘
```

### 학원장 대시보드
```
┌────────────────────────────────────────────┐
│  안녕하세요, 김학원장님! 👋                 │
│  오늘도 학생들의 학습을 관리해주세요         │
├────────────────────────────────────────────┤
│ [전체 학생] [오늘 출석] [숙제 제출] [미제출] │
│   100명      25명 (85%)    18개       7명   │
│  선생님 10명                                 │
├────────────────────────────────────────────┤
│ 오늘 출석 알림 │ 숙제 검사 결과 │ 숙제 미제출 │
│ ✓ 김학생 09:00 │ 김학생 85점    │ ⚠️ 박학생   │
│   [숙제 ✓]     │ [수학] 상/상   │   [알림]    │
│ ✓ 이학생 09:15 │ 이학생 90점    │ ⚠️ 최학생   │
│   [미제출]     │ [영어] 상/상   │   [알림]    │
└────────────────────────────────────────────┘
```

## 📝 수정/생성된 파일

### API (2개)
1. **functions/api/admin/dashboard-stats.ts** (수정)
   - 관리자 대시보드 통계 API
   - 전체 사용자, 최근 가입자
   - 오늘 출석/숙제 현황

2. **functions/api/dashboard/director-stats.ts** (생성)
   - 학원장/선생님 대시보드 API
   - 출석 알림
   - 숙제 검사 결과
   - 미제출 목록

### 프론트엔드 (1개)
3. **src/app/dashboard/page.tsx** (수정)
   - 역할별 대시보드 UI
   - 관리자 대시보드
   - 학원장 대시보드
   - 학생 대시보드

## 🚀 배포 정보

- **URL**: https://genspark-ai-developer.superplacestudy.pages.dev
- **브랜치**: genspark_ai_developer
- **최종 커밋**: b949404
- **상태**: ✅ 배포 완료

## 💡 사용 시나리오

### 시나리오 1: 관리자가 전체 현황 확인
1. 관리자 로그인
2. 대시보드 자동 표시
3. 전체 사용자 수 확인
4. 최근 가입 사용자 확인
5. 오늘 출석/숙제 현황 확인

### 시나리오 2: 학원장이 출석 확인
1. 학원장 로그인
2. 대시보드에서 "오늘 출석 알림" 확인
3. 실시간으로 학생 출석 확인
4. 숙제 제출 여부 확인

### 시나리오 3: 학원장이 미제출 학생 관리
1. 대시보드 "숙제 미제출" 섹션 확인
2. 미제출 학생 목록 확인
3. "알림" 버튼으로 학생에게 알림 발송 (준비 중)

### 시나리오 4: 선생님이 숙제 결과 확인
1. 선생님 로그인
2. "숙제 검사 결과" 섹션 확인
3. AI 채점 점수 확인
4. 과목별, 완성도/노력도 확인

## 🎯 주요 특징

### 1. 역할 기반 접근
- 각 역할에 최적화된 정보 제공
- 불필요한 정보 숨김
- 권한에 따른 기능 제공

### 2. 실시간 업데이트
- 출석 알림 실시간 표시
- 숙제 제출 즉시 반영
- 한국 시간(KST) 정확히 표시

### 3. 직관적인 UI
- 색상으로 상태 구분 (초록: 출석, 파랑: 숙제, 주황: 미제출)
- 아이콘으로 의미 전달
- 카드 형식으로 정보 그룹화

### 4. 행동 유도
- "전체 사용자 보기" 버튼
- "알림" 버튼
- "학생 관리" 바로가기

## 🔍 데이터 계산 로직

### 출석률 계산
```typescript
const attendanceRate = totalStudents > 0 
  ? Math.round((attendedToday / totalStudents) * 100) 
  : 0;
```

### 오늘 날짜 (KST)
```typescript
function getKoreanDate(): string {
  const now = new Date();
  const kstTime = new Date(now.getTime() + (9 * 60 * 60 * 1000));
  return `${year}-${month}-${day}`;
}
```

### 미제출 학생 계산
```sql
SELECT COUNT(*) as count
FROM attendance_records ar
LEFT JOIN homework_submissions hs ON ar.id = hs.attendanceRecordId
WHERE substr(ar.verifiedAt, 1, 10) = '2026-02-05'
AND hs.id IS NULL
```

## 📈 향후 개선사항

### 1. 알림 시스템
- 미제출 학생에게 자동 알림 발송
- 이메일/SMS 알림
- 푸시 알림

### 2. 차트 및 그래프
- 출석률 추이 그래프
- 숙제 점수 분포 차트
- 학생별 성장 곡선

### 3. 필터 및 검색
- 날짜 범위 선택
- 학생 이름 검색
- 과목별 필터

### 4. 학원별 데이터 격리
- academyId 기반 필터링
- 각 학원은 자신의 데이터만 조회

### 5. 구매 시스템 통합
- 실제 구매 데이터 연동
- 매출 통계
- 구매 내역

## 🐛 문제 해결

### Q: 대시보드가 로딩되지 않습니다
**A**: 
1. localStorage에 user 정보가 있는지 확인
2. user.role 값이 올바른지 확인
3. API 엔드포인트 응답 확인

### Q: 출석 알림이 표시되지 않습니다
**A**: 
1. `/api/dashboard/director-stats` 응답 확인
2. attendanceAlerts 배열 확인
3. 오늘 날짜(KST) 확인

### Q: 관리자 대시보드에 데이터가 없습니다
**A**: 
1. `/api/admin/dashboard-stats` 응답 확인
2. 데이터베이스에 사용자 데이터 확인
3. 최근 7일 가입자 확인

## ✨ 요약

**역할별 대시보드가 성공적으로 구현되었습니다!**

### 관리자 대시보드
- ✅ 전체 회원 가입 현황
- ✅ 최근 7일 가입자 목록
- ✅ 오늘 출석/숙제 현황
- ✅ 학원/학생/AI 통계

### 학원장 대시보드
- ✅ 학생/선생님 통계
- ✅ 실시간 출석 알림
- ✅ AI 숙제 검사 결과
- ✅ 숙제 미제출 알림
- ✅ 오늘 출석률 및 제출 현황

### 데이터 흐름
- ✅ 한국 시간(KST) 정확히 적용
- ✅ 실시간 업데이트
- ✅ 역할별 권한 체크

---

*구현 완료: 2026-02-05*  
*배포 환경: Cloudflare Pages*
