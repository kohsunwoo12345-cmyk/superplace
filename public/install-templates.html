<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í…œí”Œë¦¿ ì„¤ì¹˜ - Superplace</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }
    
    h1 {
      font-size: 28px;
      color: #1f2937;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .subtitle {
      color: #6b7280;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .info-box {
      background: #f3f4f6;
      border-left: 4px solid #667eea;
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 24px;
    }
    
    .info-box h3 {
      font-size: 16px;
      color: #1f2937;
      margin-bottom: 8px;
    }
    
    .info-box ul {
      margin-left: 20px;
      color: #4b5563;
      font-size: 14px;
      line-height: 1.8;
    }
    
    .input-group {
      margin-bottom: 24px;
    }
    
    label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .result {
      margin-top: 24px;
      padding: 16px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      display: none;
    }
    
    .result.success {
      background: #d1fae5;
      border: 1px solid #6ee7b7;
      color: #065f46;
      display: block;
    }
    
    .result.error {
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #991b1b;
      display: block;
    }
    
    .result.info {
      background: #dbeafe;
      border: 1px solid #93c5fd;
      color: #1e40af;
      display: block;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #fff;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-left: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .footer {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
      text-align: center;
      font-size: 14px;
      color: #6b7280;
    }
    
    .footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ ëœë”©í˜ì´ì§€ í…œí”Œë¦¿ ì„¤ì¹˜</h1>
    <div class="subtitle">5ê°œì˜ ê¸°ë³¸ í…œí”Œë¦¿ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì„¤ì¹˜í•©ë‹ˆë‹¤</div>
    
    <div class="info-box">
      <h3>ğŸ“š ì„¤ì¹˜ë˜ëŠ” í…œí”Œë¦¿</h3>
      <ul>
        <li>ğŸŒŸ í•™ìƒ ì„±ì¥ ë¦¬í¬íŠ¸ (ê¸°ë³¸)</li>
        <li>ğŸ“ ëª¨ë˜ í•™ì› ì†Œê°œ</li>
        <li>ğŸ‰ ì´ë²¤íŠ¸ & ì„¸ë¯¸ë‚˜</li>
        <li>ğŸš€ ë¬´ë£Œ ì²´í—˜ ì‹ ì²­</li>
        <li>ğŸ‘¥ í•™ë¶€ëª¨ ì»¤ë®¤ë‹ˆí‹°</li>
      </ul>
    </div>
    
    <form id="installForm">
      <div class="input-group">
        <label for="password">ì„¤ì¹˜ ë¹„ë°€ë²ˆí˜¸</label>
        <input 
          type="password" 
          id="password" 
          placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
          value="setup-templates-2026"
          required
        >
      </div>
      
      <button type="button" id="createTablesBtn" style="margin-bottom: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
        1ë‹¨ê³„: í…Œì´ë¸” ìƒì„±í•˜ê¸°
      </button>
      
      <button type="submit" id="installBtn">
        2ë‹¨ê³„: í…œí”Œë¦¿ ì„¤ì¹˜í•˜ê¸°
      </button>
      
      <button type="button" id="autoInstallBtn" style="margin-top: 12px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
        âš¡ ìë™ ì„¤ì¹˜ (í…Œì´ë¸” + í…œí”Œë¦¿)
      </button>
    </form>
    
    <div id="result" class="result"></div>
    
    <div class="footer">
      ì„¤ì¹˜ ì™„ë£Œ í›„ 
      <a href="/dashboard/admin/landing-pages/templates">í…œí”Œë¦¿ ê´€ë¦¬ í˜ì´ì§€</a>
      ë¡œ ì´ë™í•˜ì„¸ìš”
    </div>
  </div>

  <script>
    const form = document.getElementById('installForm');
    const passwordInput = document.getElementById('password');
    const createTablesBtn = document.getElementById('createTablesBtn');
    const installBtn = document.getElementById('installBtn');
    const autoInstallBtn = document.getElementById('autoInstallBtn');
    const resultDiv = document.getElementById('result');

    // 1ë‹¨ê³„: í…Œì´ë¸” ìƒì„±
    createTablesBtn.addEventListener('click', async () => {
      const password = passwordInput.value.trim();
      
      if (!password) {
        showResult('error', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      createTablesBtn.disabled = true;
      createTablesBtn.innerHTML = 'í…Œì´ë¸” ìƒì„± ì¤‘...<span class="loading"></span>';
      resultDiv.style.display = 'none';
      
      try {
        const response = await fetch('/api/setup/create-tables', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: 'setup-tables-2026' })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          showResult('success', `âœ… í…Œì´ë¸” ìƒì„± ì™„ë£Œ!\n\n${data.results.length}ê°œ ì‘ì—… ì™„ë£Œ\nì´ì œ "2ë‹¨ê³„: í…œí”Œë¦¿ ì„¤ì¹˜í•˜ê¸°"ë¥¼ í´ë¦­í•˜ì„¸ìš”.`);
        } else {
          showResult('error', `âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨\n\n${data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('Table creation error:', error);
        showResult('error', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n\n${error.message || 'ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}`);
      } finally {
        createTablesBtn.disabled = false;
        createTablesBtn.innerHTML = '1ë‹¨ê³„: í…Œì´ë¸” ìƒì„±í•˜ê¸°';
      }
    });

    // 2ë‹¨ê³„: í…œí”Œë¦¿ ì„¤ì¹˜
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const password = passwordInput.value.trim();
      
      if (!password) {
        showResult('error', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      installBtn.disabled = true;
      installBtn.innerHTML = 'ì„¤ì¹˜ ì¤‘...<span class="loading"></span>';
      resultDiv.style.display = 'none';
      
      try {
        const response = await fetch('/api/setup/templates', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
          if (data.existing > 0) {
            showResult('info', `â„¹ï¸ ${data.message}\n\nì´ë¯¸ ${data.existing}ê°œì˜ í…œí”Œë¦¿ì´ ì¡´ì¬í•©ë‹ˆë‹¤.\ní…œí”Œë¦¿ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì„¸ìš”.`);
          } else {
            showResult('success', `âœ… ${data.message}\n\nì´ ${data.total}ê°œì˜ í…œí”Œë¦¿ì´ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!\nì§€ê¸ˆ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
          }
        } else {
          showResult('error', `âŒ ì„¤ì¹˜ ì‹¤íŒ¨\n\n${data.error || data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}\n\nğŸ’¡ ë¨¼ì € "1ë‹¨ê³„: í…Œì´ë¸” ìƒì„±í•˜ê¸°"ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”.`);
        }
      } catch (error) {
        console.error('Installation error:', error);
        showResult('error', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n\n${error.message || 'ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}`);
      } finally {
        installBtn.disabled = false;
        installBtn.innerHTML = '2ë‹¨ê³„: í…œí”Œë¦¿ ì„¤ì¹˜í•˜ê¸°';
      }
    });

    // ìë™ ì„¤ì¹˜ (í…Œì´ë¸” + í…œí”Œë¦¿)
    autoInstallBtn.addEventListener('click', async () => {
      const password = passwordInput.value.trim();
      
      if (!password) {
        showResult('error', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      autoInstallBtn.disabled = true;
      autoInstallBtn.innerHTML = 'ìë™ ì„¤ì¹˜ ì¤‘...<span class="loading"></span>';
      resultDiv.style.display = 'none';
      
      try {
        // Step 1: Create tables
        showResult('info', 'âš™ï¸ 1ë‹¨ê³„: í…Œì´ë¸” ìƒì„± ì¤‘...');
        const tableResponse = await fetch('/api/setup/create-tables', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: 'setup-tables-2026' })
        });
        
        const tableData = await tableResponse.json();
        
        if (!tableResponse.ok || !tableData.success) {
          showResult('error', `âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨\n\n${tableData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`);
          return;
        }
        
        // Step 2: Install templates
        showResult('info', 'âš™ï¸ 2ë‹¨ê³„: í…œí”Œë¦¿ ì„¤ì¹˜ ì¤‘...');
        await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°
        
        const templateResponse = await fetch('/api/setup/templates', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });
        
        const templateData = await templateResponse.json();
        
        if (templateResponse.ok && templateData.success) {
          showResult('success', `âœ… ìë™ ì„¤ì¹˜ ì™„ë£Œ!\n\nğŸ“Š í…Œì´ë¸”: ${tableData.results.length}ê°œ ìƒì„±\nğŸ¨ í…œí”Œë¦¿: ${templateData.total}ê°œ ì„¤ì¹˜\n\nì§€ê¸ˆ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!`);
        } else {
          showResult('error', `âŒ í…œí”Œë¦¿ ì„¤ì¹˜ ì‹¤íŒ¨\n\n${templateData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('Auto installation error:', error);
        showResult('error', `âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n\n${error.message || 'ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}`);
      } finally {
        autoInstallBtn.disabled = false;
        autoInstallBtn.innerHTML = 'âš¡ ìë™ ì„¤ì¹˜ (í…Œì´ë¸” + í…œí”Œë¦¿)';
      }
    });
    
    function showResult(type, message) {
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
      resultDiv.style.display = 'block';
      resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
  </script>
</body>
</html>
